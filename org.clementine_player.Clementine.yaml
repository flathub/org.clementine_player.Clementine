app-id: org.clementine_player.Clementine
runtime: org.kde.Platform
runtime-version: 5.15-25.08
sdk: org.kde.Sdk
command: clementine
finish-args:
  - --device=dri
  - --filesystem=/media
  - --filesystem=/mnt
  - --filesystem=/run/media
  - --filesystem=xdg-music
  - --own-name=org.kde.StatusNotifierItem-2-2
  - --own-name=org.mpris.MediaPlayer2.clementine
  - --share=ipc
  - --share=network
  - --socket=pulseaudio
  - --socket=fallback-x11
  - --socket=wayland
  - --system-talk-name=org.freedesktop.Avahi
  - --system-talk-name=org.freedesktop.UDisks2
  - --talk-name=org.freedesktop.Notifications
  - --talk-name=org.kde.StatusNotifierWatcher
  - --talk-name=org.mpris.MediaPlayer2.Player
  - --talk-name=org.wiimotedev.deviceEvents
cleanup:
  - /include
  - /lib/cmake
  - /lib/pkgconfig
  - /share/doc
  - /share/gtk-doc
  - /share/info
  - /share/man
  - /lib/*.a
  - /lib/*.la
modules:
  - glew.json
  - glu-9.json
  - fftwf3.json
  - libusb.json
  - name: libmtp
    config-opts:
      - --disable-static
      - --with-udev=/app/lib/udev
    sources:
      - type: archive
        url: https://github.com/libmtp/libmtp/releases/download/v1.1.22/libmtp-1.1.22.tar.gz
        sha256: c3fcf411aea9cb9643590cbc9df99fa5fe30adcac695024442973d76fa5f87bc
        x-checker-data:
          type: anitya
          project-id: 10017
          url-template: https://github.com/libmtp/libmtp/releases/download/v$version/libmtp-$version.tar.gz
  - name: boost
    buildsystem: simple
    build-commands:
      - ./bootstrap.sh --prefix="${FLATPAK_DEST}"
      - ./b2 -j ${FLATPAK_BUILDER_N_JOBS} headers
      - cp -r boost "${FLATPAK_DEST}/include/boost"
    sources:
      - type: archive
        url: https://archives.boost.io/release/1.90.0/source/boost_1_90_0.tar.bz2
        sha256: 49551aff3b22cbc5c5a9ed3dbc92f0e23ea50a0f7325b0d198b705e8ee3fc305
        x-checker-data:
          type: anitya
          project-id: 6845
          stable-only: true
          url-template: https://archives.boost.io/release/$version/source/boost_${major}_${minor}_$patch.tar.bz2

  - name: protobuf
    buildsystem: cmake-ninja
    config-opts:
      - -Dprotobuf_BUILD_TESTS=OFF
    sources:
      - type: archive
        url: https://github.com/protocolbuffers/protobuf/archive/v33.4.tar.gz
        sha256: 136a07aad488cc502b11c4416fe4a7df2dfdea1d0833a7a8211000bf952728ba
        x-checker-data:
          type: anitya
          project-id: 3715
          stable-only: true
          url-template: https://github.com/protocolbuffers/protobuf/archive/v$version.tar.gz
    cleanup:
      - /bin

  - name: chromaprint
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_SHARED_LIBS=ON
    sources:
      - type: archive
        url: https://github.com/acoustid/chromaprint/releases/download/v1.6.0/chromaprint-1.6.0.tar.gz
        sha256: 9d33482e56a1389a37a0d6742c376139fa43e3b8a63d29003222b93db2cb40da
        x-checker-data:
          type: anitya
          project-id: 286
          stable-only: true
          url-template: https://github.com/acoustid/chromaprint/releases/download/v$version/chromaprint-$version.tar.gz

  - name: libcdio
    config-opts:
      - --without-cd-drive
      - --without-cd-info
      - --without-cdda-player
      - --without-cd-read
      - --without-iso-info
      - --without-iso-read
      - --with-pic
      - --disable-static
    sources:
      - type: archive
        url: https://github.com/libcdio/libcdio/releases/download/2.3.0/libcdio-2.3.0.tar.bz2
        sha256: 53e83d284667535a767fd2d31edad1a6701591960459df373a10f1f21e80a7ed
        x-checker-data:
          type: anitya
          project-id: 1573
          stable-only: true
          url-template: https://github.com/libcdio/libcdio/releases/download/$version/libcdio-$version.tar.bz2
    cleanup:
      - /bin

  - name: cryptopp
    only-arches:
      - x86_64
    no-autogen: true
    make-args: [libcryptopp.so]
    make-install-args: [PREFIX=/app]
    post-install:
      - install -Dm644 -t "${FLATPAK_DEST}/lib/pkgconfig/" libcrypto++.pc
    sources:
      - type: archive
        url: https://github.com/weidai11/cryptopp/archive/CRYPTOPP_8_9_0.tar.gz
        sha256: ab5174b9b5c6236588e15a1aa1aaecb6658cdbe09501c7981ac8db276a24d9ab
        x-checker-data:
          type: anitya
          project-id: 14487
          stable-only: true
          url-template: https://github.com/weidai11/cryptopp/archive/CRYPTOPP_${major}_${minor}_$patch.tar.gz
      - type: file
        path: patches/libcrypto++.pc

  - name: taglib
    buildsystem: cmake-ninja
    config-opts:
      - -DBUILD_SHARED_LIBS=ON
    sources:
      - type: archive
        url: http://taglib.github.io/releases/taglib-2.1.1.tar.gz
        sha256: 3716d31f7c83cbf17b67c8cf44dd82b2a2f17e6780472287a16823e70305ddba
        x-checker-data:
          type: anitya
          project-id: 1982
          stable-only: true
          url-template: http://taglib.github.io/releases/taglib-$version.tar.gz
    cleanup:
      - /bin

  - name: libmygpo-qt
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_BUILD_TYPE=RelWithDebInfo
      - -DBUILD_SHARED_LIBS=ON
    sources:
      - type: archive
        url: https://github.com/gpodder/libmygpo-qt/archive/1.2.0.tar.gz
        sha256: 71d6461939be14c044d1688bd3381cb3a724c0acb292d34fe63b9c677a4d2247
        x-checker-data:
          type: anitya
          project-id: 1671
          stable-only: true
          url-template: https://github.com/gpodder/libmygpo-qt/archive/$version.tar.gz

  - name: sparsehash
    sources:
      - type: archive
        url: https://github.com/sparsehash/sparsehash/archive/sparsehash-2.0.4.tar.gz
        sha256: 8cd1a95827dfd8270927894eb77f62b4087735cbede953884647f16c521c7e58
        x-checker-data:
          type: anitya
          project-id: 4863
          stable-only: true
          url-template: https://github.com/sparsehash/sparsehash/archive/sparsehash-$version.tar.gz

  - name: liblastfm
    buildsystem: cmake-ninja
    config-opts:
      - -DCMAKE_POLICY_VERSION_MINIMUM=3.5
    build-options:
      cxxflags: -std=c++14
    sources:
      - type: archive
        url: https://github.com/lastfm/liblastfm/archive/1.1.0.tar.gz
        sha256: f61f0daa384e081a8f2bd2f7a2148babff22696e5b72ecdac86940a10100b1c8
        x-checker-data:
          type: anitya
          project-id: 1651
          stable-only: true
          url-template: https://github.com/lastfm/liblastfm/archive/$version.tar.gz

  - name: clementine
    builddir: true
    buildsystem: cmake-ninja
    config-opts:
      - -DFORCE_GIT_REVISION:STRING=1.4.1-50-ge281c4508
      - -DCMAKE_POLICY_VERSION_MINIMUM=3.5
    post-install:
      - install -Dm644 -t "${FLATPAK_DEST}/share/metainfo" ../org.clementine_player.Clementine.appdata.xml
    sources:
      - type: archive
        url: https://github.com/clementine-player/Clementine/releases/download/1.4.1-60-g1a3e8b56f/clementine-1.4.1-60-g1a3e8b56f.tar.xz
        sha256: 8296048cd2c38ff7143678b2db7743cde2abd6f8fefa89239630a79a595f1c86
        x-checker-data:
          type: anitya
          project-id: 295
          stable-only: true
          url-template: https://github.com/clementine-player/Clementine/releases/download/$version/clementine-$version.tar.xz
      - type: patch
        path: patches/icon-size.patch
      - type: patch
        path: patches/clementine.save_playlists_to_xdg-config-home.patch
      - type: patch
        path: patches/0001-Remove-CMP0053-policy-from-CMake.patch
      - type: patch
        path: patches/0001-Remove-CMP0005-from-libprojectm-CMakeLists.txt.patch
      - type: patch
        path: patches/0001-Remove-CMP0017-from-libprojectm-CMakeLists.txt.patch
      - type: file
        path: org.clementine_player.Clementine.appdata.xml
